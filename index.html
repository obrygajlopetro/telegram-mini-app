<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Выбор локации</title>
</head>
<body style="margin:0; background:#000; color:white; font-family:sans-serif;">

  <!-- Модальное окно выбора города и метро -->
  <div id="city-metro-modal" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:#1e1e1e;border-radius:10px;padding:20px;width:90%;max-width:400px;text-align:center;">
    <img src="https://via.placeholder.com/128x64" alt="Баннер" style="width:128px;height:64px;object-fit:contain;margin-bottom:10px;">
    <h2 style="font-size:16px;margin:10px 0;">Выбери город и станцию метро</h2>

    <select id="city-select" style="width:100%;padding:10px;margin:10px 0;border-radius:5px;border:none;background:#333;color:white;">
      <option value="moscow">Москва</option>
      <option value="spb">Санкт-Петербург</option>
    </select>

    <select id="metro-select" style="width:100%;padding:10px;margin:10px 0;border-radius:5px;border:none;background:#333;color:white;"></select>

    <button id="confirm-btn" style="width:100%;padding:10px;margin-top:10px;border-radius:5px;border:none;background:#444;color:white;">
      Подтвердить
    </button>
  </div>

  <!-- Лоадбар -->
  <div id="loader" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:#1e1e1e; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center;">
    <div id="loader-text" style="margin-bottom:10px;">Загрузка...</div>
    <div style="background:#444; height:20px; border-radius:10px; overflow:hidden;">
      <div id="loader-bar" style="height:100%; width:0%; background:white; transition:width 0.1s;"></div>
    </div>
  </div>

  <script>
    const citySelect = document.getElementById("city-select");
    const metroSelect = document.getElementById("metro-select");
    const confirmBtn = document.getElementById("confirm-btn");
    const modal = document.getElementById("city-metro-modal");
    const loader = document.getElementById("loader");
    const loaderText = document.getElementById("loader-text");
    const loaderBar = document.getElementById("loader-bar");

    const metroStations = {
      moscow: [...], // <- сюда вставь список станций из предыдущего кода
      spb: [...]
    };

    function updateMetroOptions(city) {
      metroSelect.innerHTML = "";
      metroStations[city].forEach(station => {
        const option = document.createElement("option");
        option.value = station;
        option.textContent = station;
        metroSelect.appendChild(option);
      });
    }

    citySelect.addEventListener("change", () => {
      updateMetroOptions(citySelect.value);
    });

    document.addEventListener("DOMContentLoaded", () => {
      updateMetroOptions(citySelect.value);
    });

    confirmBtn.addEventListener("click", () => {
      const selectedCity = citySelect.value;
      const selectedMetro = metroSelect.value;

      modal.style.display = "none";
      loader.style.display = "block";
      loaderText.textContent = `Загрузка витрины для станции метро ${selectedMetro}...`;

      const duration = 3000 + Math.random() * 7000; // от 3 до 10 секунд
      let start = null;

      function animate(timestamp) {
        if (!start) start = timestamp;
        const elapsed = timestamp - start;
        const progress = Math.min((elapsed / duration) * 100, 100);
        loaderBar.style.width = progress + "%";

        if (progress < 100) {
          requestAnimationFrame(animate);
        } else {
          loaderText.textContent = "Готово!";
          // Следующий шаг можно вызвать здесь
        }
      }

      requestAnimationFrame(animate);
    });
  </script>
</body>
</html>
