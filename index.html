
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–í–∏—Ç—Ä–∏–Ω–∞</title>
  <style>
    body {
      margin: 0;
      background: #121212;
      color: white;
      font-family: sans-serif;
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: #1e1e1e;
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: none;
      background: #444;
      color: white;
      cursor: pointer;
    }
    .loader, .order-loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2000;
      background: #1e1e1e;
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }  
    .payment-screen {
    position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2000;
      background: #1e1e1e;
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      text-align: left;
    }
    .progress-container {
      width: 100%;
      background: #333;
      border-radius: 5px;
      overflow: hidden;
      height: 10px;
    }
    .progress-bar {
      width: 0;
      height: 100%;
      background: white;
    }
   .blurred > *:not(#order-loader) {
  filter: blur(6px);
  pointer-events: none;
  user-select: none;
}
    }
    .yellow-box {
      background: #26201f;
      border: 1px solid #9c0602;
      border-radius: 8px;
      padding: 10px;
      color: #9c0602;
      margin-top: 10px;
      font-size: 14px;
    }
    .blue-box {
  background: #001f3f;
  border: 1px solid #3399ff;
  border-radius: 8px;
  padding: 10px;
  color: #aad8ff;
  margin-top: 10px;
  font-size: 14px;
}
  </style>
</head>
<body>
<!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ –∏ –º–µ—Ç—Ä–æ -->

<div id="city-metro-modal" class="modal">
  <img src="https://via.placeholder.com/128x64" alt="–ë–∞–Ω–Ω–µ—Ä" style="width:128px;height:64px;object-fit:contain;margin-bottom:10px;">
  <h2 style="font-size:16px;margin:10px 0;">–í—ã–±–µ—Ä–∏ –≥–æ—Ä–æ–¥ –∏ —Å—Ç–∞–Ω—Ü–∏—é –º–µ—Ç—Ä–æ</h2>
  <select id="city-select" style="width:100%;padding:10px;margin:10px 0;border-radius:5px;border:none;background:#333;color:white;">
    <option value="moscow">–ú–æ—Å–∫–≤–∞</option>
    <option value="spb">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
  </select>
  <select id="metro-select" style="width:100%;padding:10px;margin:10px 0;border-radius:5px;border:none;background:#333;color:white;"></select>
  <button id="confirm-btn" class="button">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>

<!-- –õ–æ–∞–¥–±–∞—Ä -->
<div id="loader" class="loader" style="display:none;">
  <p id="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã...</p>
  <div class="progress-container">
    <div id="progress-bar" class="progress-bar"></div>
  </div>
</div>

<!-- –í–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
<div id="storefront" style="display:none; padding:20px;">
  <h2 id="store-title" style="text-align:center;">–í–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</h2>
  <div id="product-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:20px;margin-top:20px;"></div>
</div>

<!-- –õ–æ–∞–¥–±–∞—Ä –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ -->
<div id="order-loader" class="order-loader" style="display:none;">
  <p id="order-loader-text"> üìë –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–∫–∞–∑—É...</p>
  <div class="progress-container">
    <div id="order-progress-bar" class="progress-bar"></div>
  </div>
</div>

<!-- –≠–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã -->
<div id="payment-screen" class="payment-screen" style="display:none;"></div>

<script>
  const citySelect = document.getElementById("city-select");
  const metroSelect = document.getElementById("metro-select");
  const modal = document.getElementById("city-metro-modal");
  const loader = document.getElementById("loader");
  const loaderText = document.getElementById("loader-text");
  const progressBar = document.getElementById("progress-bar");
  const storefront = document.getElementById("storefront");
  const productGrid = document.getElementById("product-grid");
  const storeTitle = document.getElementById("store-title");
  const paymentScreen = document.getElementById("payment-screen");
  let selectedMetro = "";
  let savedOrderId = null;
  let lastCheckTime = null;

  const products = [
    "–ö—Ä–∞—Å–Ω—ã–π –∫—É–±–∏–∫", "–°–∏–Ω–∏–π —à–∞—Ä", "–ñ—ë–ª—Ç—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫", "–ó–µ–ª—ë–Ω—ã–π —Ü–∏–ª–∏–Ω–¥—Ä",
    "–û—Ä–∞–Ω–∂–µ–≤–∞—è –ø–∏—Ä–∞–º–∏–¥–∞", "–°–∏—Ä–µ–Ω–µ–≤–∞—è –∑–≤–µ–∑–¥–∞", "–ë–µ–ª—ã–π –∫–æ–Ω—É—Å", "–ß—ë—Ä–Ω—ã–π –∫—É–±",
    "–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —à–∞—Ä", "–ù–µ–æ–Ω–æ–≤—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫"
  ];

  const metroStations = {
    moscow: ["–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥", "–¢–≤–µ—Ä—Å–∫–∞—è", "–ê—Ä–±–∞—Ç—Å–∫–∞—è"],
    spb: ["–ì–æ—Å—Ç–∏–Ω—ã–π –¥–≤–æ—Ä", "–ú–∞—è–∫–æ–≤—Å–∫–∞—è", "–°–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å"]
  };

  function updateMetroOptions(city) {
    metroSelect.innerHTML = "";
    metroStations[city].forEach(station => {
      const option = document.createElement("option");
      option.value = station;
      option.textContent = station;
      metroSelect.appendChild(option);
    });
  }

  citySelect.addEventListener("change", () => {
    updateMetroOptions(citySelect.value);
  });

  document.addEventListener("DOMContentLoaded", () => {
    updateMetroOptions(citySelect.value);
  });

  document.getElementById("confirm-btn").addEventListener("click", () => {
    selectedMetro = metroSelect.value;
    modal.style.display = "none";
    loaderText.textContent = `üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ ${selectedMetro}...`;
    loader.style.display = "block";
    let progress = 0;
    const duration = 3000 + Math.random() * 7000;
    const start = Date.now();

    function animateLoader() {
      progress = (Date.now() - start) / duration * 100;
      progressBar.style.width = Math.min(progress, 100) + "%";
      if (progress < 100) {
        requestAnimationFrame(animateLoader);
      } else {
        loader.style.display = "none";
        storeTitle.textContent = `–í–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ ${selectedMetro}`;
        renderProducts();
        storefront.style.display = "block";
      }
    }
    animateLoader();
  });

  function renderProducts() {
    productGrid.innerHTML = "";
    for (let i = 0; i < 10; i++) {
      const card = document.createElement("div");
      card.style.background = "#1e1e1e";
      card.style.borderRadius = "10px";
      card.style.padding = "10px";
      card.innerHTML = `
        <img src="https://via.placeholder.com/150" style="width:100%;border-radius:10px;object-fit:cover;margin-bottom:10px;" />
        <h3 style="margin:0 0 5px 0; font-size:14px;">${products[i]}</h3>
        <p style="margin:0 0 5px 0;">–¶–µ–Ω–∞: ${(1000 + i * 100)}‚ÇΩ</p>
        <select class="qty-select" style="width:100%;padding:5px;margin-bottom:5px;background:#333;color:white;border:none;border-radius:5px;">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
        <select class="delivery-method" style="width:100%;padding:5px;margin-bottom:5px;background:#333;color:white;border:none;border-radius:5px;">
          <option>–ê–¥—Ä–µ—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</option><option>–°–∞–º–æ–≤—ã–≤–æ–∑</option><option>–ü–æ—á—Ç–∞</option>
        </select>
        <button class="buy-btn button">–ö—É–ø–∏—Ç—å</button>
      `;
      productGrid.appendChild(card);
    }
  }

  function showOrderLoader(productName, price, qty, deliveryMethod) {
    savedOrderId = savedOrderId || Math.floor(100000 + Math.random() * 900000);
    const orderLoader = document.getElementById("order-loader");
    const orderText = document.getElementById("order-loader-text");
    const orderProgress = document.getElementById("order-progress-bar");
    orderText.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–∫–∞–∑—É #${savedOrderId}`;
    document.body.classList.add("blurred");
    orderLoader.style.display = "block";
    orderProgress.style.width = "0%";
    const duration = 3000 + Math.random() * 4000;
    const start = Date.now();
    function updateProgress() {
      const percent = Math.min((Date.now() - start) / duration * 100, 100);
      orderProgress.style.width = `${percent}%`;
      if (percent < 100) {
        requestAnimationFrame(updateProgress);
      } else {
        orderLoader.style.display = "none";
        document.body.classList.remove("blurred");
        showPaymentScreen(productName, price, qty, deliveryMethod);
      }
    }
    requestAnimationFrame(updateProgress);
  }

  function showPaymentScreen(name, price, qty, deliveryMethod) {
    const sum = price * qty;
    const card = "1234 5678 9012 3456";
    const timeNow = new Date().toLocaleTimeString();
    const dateNow = new Date().toLocaleDateString();
    paymentScreen.innerHTML = `
      <h3>‚ôªÔ∏è –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ #${savedOrderId}</h3>
      <p>‚åû–í—Ä–µ–º—è –∏ –¥–∞—Ç–∞: ${timeNow}, ${dateNow}</p>
      <p>‚åû–ü–æ–∑–∏—Ü–∏—è: ${name}</p>
      <p>‚åû–ú–µ—Ç—Ä–æ: ${selectedMetro}</p>
      <p>‚åû–ú–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏: ${deliveryMethod}</p>
      <br>
      <p><strong>üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</strong> ${card}</p>
      <p><strong>üíµ –°—É–º–º–∞:</strong> ${sum}‚ÇΩ</p>
      <p id="timer"></p>
      <button id="check-payment-btn" class="button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
      <button id="restart-btn" class="button">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∑–∞–Ω–æ–≤–æ</button>
      <div id="payment-message"></div>
    `;
    storefront.style.display = "none";
    paymentScreen.style.display = "block";

   const timer = document.getElementById("timer");
let remaining = 15 * 60;
const timerBox = document.createElement("div");
timerBox.className = "blue-box";
timer.appendChild(timerBox);

setInterval(() => {
  if (remaining > 0) {
    const min = Math.floor(remaining / 60);
    const sec = remaining % 60;
    timerBox.textContent = `–î–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–ª–∞—Ç—ã: ${min}:${sec.toString().padStart(2, '0')}`;
    remaining--;
  }
}, 1000);
    
    document.getElementById("check-payment-btn").onclick = () => {
      const messageBox = document.getElementById("payment-message");
      messageBox.innerHTML = `<p>üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã –ø–æ –∑–∞–∫–∞–∑—É #${savedOrderId}...</p>`;
      const delay = 2000 + Math.random() * 4000;
      setTimeout(() => {
        lastCheckTime = new Date().toLocaleTimeString();
        messageBox.innerHTML = `<div class='yellow-box'> ‚ùå –û–ø–ª–∞—Ç–∞ –Ω–∞ —Å—É–º–º—É ${sum}‚ÇΩ –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º ${card} –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–ª–∞—Ç—ë–∂ –ø—Ä–æ–≤–µ–¥—ë–Ω –±–∞–Ω–∫–æ–º –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ. <br> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ${lastCheckTime}</div>`;
      }, delay);
    };
    
    document.getElementById("restart-btn").onclick = () => {
      savedOrderId = null;
      storefront.style.display = "none";
      paymentScreen.style.display = "none";
      modal.style.display = "block";
    };
  }

  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("buy-btn")) {
      const card = e.target.closest("div");
      const name = card.querySelector("h3").textContent;
      const price = parseInt(card.querySelector("p").textContent.match(/\d+/)[0]);
      const qty = parseInt(card.querySelector(".qty-select").value);
      const method = card.querySelector(".delivery-method").value;
      showOrderLoader(name, price, qty, method);
    }
  });
</script>
</body>
</html>
